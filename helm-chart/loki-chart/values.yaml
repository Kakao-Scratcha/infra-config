# Single Binary 모드 설정
deploymentMode: SingleBinary

# PodSecurityPolicy 비활성화 (Kubernetes 1.25+ 에서 deprecated)
podSecurityPolicy:
  enabled: false

loki:
  enabled: true
  commonConfig:
    replication_factor: 1
  schemaConfig:
    configs:
      - from: "2024-04-01"
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h
  limits_config:
    allow_structured_metadata: true
    volume_enabled: true
    retention_period: 168h # 7일 보존
  storage:
    type: s3
    bucketNames:
      chunks: ${LOKI_S3_BUCKET}
      ruler: ${LOKI_S3_BUCKET}
      admin: ${LOKI_S3_BUCKET}
    s3:
      endpoint: ${LOKI_S3_ENDPOINT}
      region: kr-central-2
      secretAccessKey: ${LOKI_S3_SECRET_KEY}
      accessKeyId: ${LOKI_S3_ACCESS_KEY}
      s3ForcePathStyle: true
      insecure: false

singleBinary:
  replicas: 1
  persistence:
    enabled: true
    storageClass: csi-cinder-sc-retain
    accessModes:
      - ReadWriteOnce
    size: 10Gi
  extraEnv:
    - name: LOKI_S3_ENDPOINT
      valueFrom:
        secretKeyRef:
          name: loki-s3-secret
          key: endpoint
    - name: LOKI_S3_BUCKET
      valueFrom:
        secretKeyRef:
          name: loki-s3-secret
          key: bucket
    - name: LOKI_S3_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: loki-s3-secret
          key: access-key
    - name: LOKI_S3_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: loki-s3-secret
          key: secret-key
    - name: HTTP_PROXY
      value: "http://10.0.130.50:3128"
    - name: HTTPS_PROXY
      value: "http://10.0.130.50:3128"
    - name: NO_PROXY
      value: "localhost,127.0.0.1,.svc.cluster.local,.cluster.local,10.96.0.0/12,10.244.0.0/16,10.0.0.0/8,kubernetes.default.svc.cluster.local"
    - name: http_proxy
      value: "http://10.0.130.50:3128"
    - name: https_proxy
      value: "http://10.0.130.50:3128"
    - name: no_proxy
      value: "localhost,127.0.0.1,.svc.cluster.local,.cluster.local,10.96.0.0/12,10.244.0.0/16,10.0.0.0/8,kubernetes.default.svc.cluster.local"
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  nodeSelector:
    kakaoi.io/kke-nodepool: team2-api
  service:
    type: ClusterIP
    port: 3100

# 다른 배포 모드들은 비활성화
backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0
gateway:
  replicas: 0
queryScheduler:
  replicas: 0
indexGateway:
  replicas: 0
compactor:
  replicas: 0
distributor:
  replicas: 0
ingester:
  replicas: 0
querier:
  replicas: 0
queryFrontend:
  replicas: 0

# MinIO 비활성화
minio:
  enabled: false
promtail:
  enabled: true
  podSecurityPolicy:
    enabled: false
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  nodeSelector:
    kakaoi.io/kke-nodepool: team2-api
  extraEnv:
    - name: HTTP_PROXY
      value: "http://10.0.130.50:3128"
    - name: HTTPS_PROXY
      value: "http://10.0.130.50:3128"
    - name: NO_PROXY
      value: "localhost,127.0.0.1,.svc.cluster.local,.cluster.local,10.96.0.0/12,10.244.0.0/16,10.0.0.0/8,kubernetes.default.svc.cluster.local"
    - name: http_proxy
      value: "http://10.0.130.50:3128"
    - name: https_proxy
      value: "http://10.0.130.50:3128"
    - name: no_proxy
      value: "localhost,127.0.0.1,.svc.cluster.local,.cluster.local,10.96.0.0/12,10.244.0.0/16,10.0.0.0/8,kubernetes.default.svc.cluster.local"